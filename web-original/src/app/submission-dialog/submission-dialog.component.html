<ng-container *ngIf="submissionQueryRef.valueChanges | async as submissionResult">
  <ng-container *ngIf="submissionResult.data.submission as submission">
    <div class="submission-dialog-header">
      <h5>
        Submission for: <strong>{{ problem.material.title | textVariant }}</strong>
      </h5>
    </div>
    <div class="submission-pending" *ngIf="submission.evaluation.status === 'PENDING'">
      <fa-icon [icon]="faSpinner" [pulse]="true"></fa-icon> Evaluating...
    </div>
    <div class="submission-dialog-body">
      <ng-container *ngIf="submissionResult.data | applyPure: getEvaluationRecord as record">
        <ng-container *ngFor="let section of problem.material.feedback">
          <ng-container [ngSwitch]="section.__typename">
            {{ section.caption | textVariant }}
            <ag-grid-angular
              *ngSwitchCase="'TableSection'"
              class="ag-theme-balham feedback-table"
              [suppressCellSelection]="true"
              [suppressChangeDetection]="true"
              [suppressRowHoverHighlight]="true"
              domLayout="autoHeight"
              [rowData]="section.rows"
              [gridOptions]="{} | gridOptions"
              rowClass="feedback-table-row"
              [columnDefs]="record | applyPure: getColumnDefs:section"
              [context]="{ problem: problem, record: record }"
            >
            </ag-grid-angular>
          </ng-container>
        </ng-container>
      </ng-container>
    </div>
  </ng-container>
  <div class="submission-dialog-footer">
    <button (click)="modal.close()" class="submission-dialog-close">Close</button>
  </div>
</ng-container>

<ng-template #scoreCell let-cell="cell" let-value="value" let-valence="valence" let-eGridCell="eGridCell">
  <ng-container [appValence]="valence" [appValenceNativeElement]="eGridCell"></ng-container>
  <ng-container *ngIf="value !== undefined">
    {{ value.toFixed(cell.content.range.precision) }}
  </ng-container>
  <small>
    /
    {{ cell.content.range.max.toFixed(cell.content.range.precision) }}
  </small>
</ng-template>

<ng-template #timeUsageCell let-cell="cell" let-value="value" let-valence="valence" let-eGridCell="eGridCell">
  <ng-container [appValence]="valence" [appValenceNativeElement]="eGridCell"></ng-container>
  <ng-container *ngIf="value !== undefined">
    {{ displayTimeUsageSeconds(value, cell.content) }}
  </ng-container>
  <small *ngIf="cell.content.timeUsagePrimaryWatermark as watermark">
    /
    {{ displayTimeUsageSeconds(watermark.seconds, cell.content) }}
  </small>
</ng-template>

<ng-template #memoryUsageCell let-cell="cell" let-value="value" let-valence="valence" let-eGridCell="eGridCell">
  <ng-container [appValence]="valence" [appValenceNativeElement]="eGridCell"></ng-container>
  <ng-container *ngIf="value !== undefined">
    {{ value | filesize }}
  </ng-container>
  <small *ngIf="cell.content.memoryUsagePrimaryWatermark as watermark">
    /
    {{ watermark.bytes | filesize }}
  </small>
</ng-template>

<ng-template #messageCell let-cell="cell" let-value="value" let-valence="valence" let-eGridCell="eGridCell">
  <ng-container [appValence]="valence" [appValenceNativeElement]="eGridCell"></ng-container>
  {{ value }}
</ng-template>
