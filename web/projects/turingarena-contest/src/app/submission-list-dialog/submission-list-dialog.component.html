<ng-container *ngIf="submissionListQuery.valueChanges | async as submissionListResult">
  <ng-container *ngIf="submissionListResult.data as data">
    <ng-container *ngIf="data.contestView.problem as problem">
      <ng-container *ngIf="getProblemState(problem) as problemState">
        <div class="modal-header">
          <h4 class="modal-title">Submissions for: <strong>{{ problem.material.title[0].value }}</strong></h4>
        </div>
        <div class="submissions_modal_body">
          <table class="submission_table">
            <thead class="submission_table_header">
              <tr>
                <th scope="col" rowspan="2">Submission time</th>
                <th *ngFor="let award of problem.material.awards">
                  {{ award.title[0].value }}
                </th>
                <th scope="col">Total score</th>
              </tr>
              <tr>
                <ng-container *ngFor="let award of problem.material.awards">
                  <ng-container *ngIf="award.content.range as range">
                    <th *ngIf="problemState.award(award) as state" class="submission_best_score score"
                      [class.score_zero]="state.score <= 0"
                      [class.score_partial]="0 < state.score && state.score < range.max"
                      [class.score_full]="range.max <= state.score">
                      <span>
                        {{ state.score.toFixed(award.precision) }}
                      </span>/<span>
                        {{ range.max.toFixed(award.precision) }}
                      </span>
                    </th>
                  </ng-container>
                  <ng-container *ngIf="!award.content.range">
                    <th>
                      Badge (todo)
                    </th>
                  </ng-container>
                </ng-container>
                <th class="submission_best_total_score score" [class.score_zero]="getProblemState(problem).score <= 0"
                  [class.score_partial]="0 < getProblemState(problem).score && getProblemState(problem).score < getProblemState(problem).maxScore"
                  [class.score_full]="getProblemState(problem).maxScore <= getProblemState(problem).score">
                  <span>
                    {{ getProblemState(problem).score.toFixed(getProblemState(problem).precision) }}
                  </span>/<span>
                    {{ getProblemState(problem).maxScore.toFixed(getProblemState(problem).precision) }}
                  </span>
                </th>
              </tr>
            </thead>
            <tbody class="submission_table_body">
              <tr class="submission_row" *ngFor="let _ of problem.submissions; index as submissionIndex">
                <ng-container *ngIf="problem.submissions[problem.submissions.length-submissionIndex-1] as submission">
                  <td>
                    <app-relative-time [time]="submission.createdAt"></app-relative-time>
                    <br />
                    <a href="#" (click)="this.openDetail(submission); $event.preventDefault()">
                      details
                    </a>
                  </td>
                  <ng-container *ngIf="submission.status === 'SUCCESS'">
                    <ng-container *ngIf="getSubmissionState(problem, submission) as submissionState">
                      <ng-container *ngFor="let award of problem.material.awards">
                        <ng-container *ngIf="award.content.range as range">
                          <td *ngIf="submissionState.award(award) as state" class="submission_score score"
                            [class.score_zero]="state.score <= 0"
                            [class.score_partial]="0 < state.score && state.score < range.max"
                            [class.score_full]="range.max <= state.score">
                            <span class="submission_score">
                              {{ state.score.toFixed(range.precision) }}
                            </span>/<span class="submission_max_score">
                              {{ range.max.toFixed(range.precision) }}
                            </span>
                          </td>
                        </ng-container>
                        <ng-container *ngIf="!award.content.range">
                          <td>
                            Badge (todo)
                          </td>
                        </ng-container>
                      </ng-container>
                      <td class="submission_total_score score" [class.score_zero]="submissionState.score <= 0"
                        [class.score_partial]="0 < submissionState.score && submissionState.score < problemState.maxScore"
                        [class.score_full]="problemState.maxScore <= submissionState.score">
                        <span class="submission_total_score">
                          {{ submissionState.score.toFixed(problemState.precision) }}
                        </span>/<span class="submission_total_max_score">
                          {{ problemState.maxScore.toFixed(problemState.precision) }}
                        </span>
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="submission.status === 'PENDING'">
                    <td [colSpan]="problem.material.awards.length + 1">Evaluating...</td>
                  </ng-container>
                </ng-container>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="submissions_modal_footer">
          <button (click)="activeModal.close()" class="submissions_modal_close_button">Cancel</button>
        </div>
      </ng-container>
    </ng-container>
  </ng-container>
</ng-container>
