<ng-container *ngIf="appComponent.contestQuery.valueChanges | async as contestResult">
  <ng-container *ngIf="contestResult.data as data">
    <ng-container *ngFor="let problem of data.contestView.problems">
      <ng-container *ngIf="problem.name === problemName">
        <div class="evaluation_modal_header">
          Evaluation
        </div>
        <div class="evaluation_modal_body">
          <ng-container *ngIf="recordObservable | async as record">
            <ng-container *ngFor="let section of problem.material.feedback">
              <ng-container [ngSwitch]="section.__typename">
                <table *ngSwitchCase="'TableSection'" class="evaluation_table">
                  <thead class="evaluation_table_header">
                    <tr>
                      <th [colSpan]="section.cols.length">
                        {{ section.caption[0].value }}
                      </th>
                    </tr>
                  </thead>
                  <tbody *ngFor="let group of section.rowGroups; index as i" class="evaluation_group">
                    <tr>
                      <th [colSpan]="section.cols.length">
                        {{ group.title[0].value }}
                      </th>
                    </tr>
                    <tr class="group_header_row">
                      <ng-container *ngFor="let col of section.cols; index as i">
                        <ng-container [ngSwitch]="col.content.__typename">
                          <th *ngSwitchDefault="">
                            {{ col.title[0].value }}
                          </th>
                        </ng-container>
                      </ng-container>
                    </tr>
                    <tr *ngFor="let row of group.rows" class="evaluation_row">
                      <ng-container *ngFor="let col of section.cols; index as i">
                        <ng-container *ngIf="row.cells[i] as cell" [ngSwitch]="cell.content.__typename">
                          <th *ngSwitchCase="'RowNumberCellContent'" class="score_cell">
                            {{ cell.content.number }}
                          </th>
                          <th *ngSwitchCase="'RowTitleCellContent'" class="score_cell">
                            {{ cell.content.title[0].value }}
                          </th>
                          <ng-container *ngSwitchCase="'ScoreCellContent'">
                            <ng-container *ngIf="record[cell.content.ref] as value">
                              <td class="score_cell" [class.score_zero]="value.score <= 0"
                                [class.score_partial]="0 < value.score && value.score < cell.content.range.max"
                                [class.score_full]="cell.content.range.max <= value.score">
                                {{ value.score.toFixed(cell.content.range.precision) }} /
                                {{ col.content.range.max.toFixed(cell.content.range.precision) }}
                              </td>
                            </ng-container>
                            <ng-container *ngIf="!record[cell.content.ref]">
                              <td class="score_cell">
                                ... / {{ col.content.range.max.toFixed(cell.content.range.precision) }}
                              </td>
                            </ng-container>
                          </ng-container>
                          <td *ngSwitchDefault="">
                            ?
                          </td>
                        </ng-container>
                      </ng-container>
                    </tr>
                  </tbody>
                </table>
              </ng-container>
            </ng-container>
          </ng-container>
        </div>
        <div class="evaluation_modal_footer">
          <button (click)="activeModal.close()" class="evaluation_modal_close_button">Close</button>
        </div>
      </ng-container>
    </ng-container>
  </ng-container>
</ng-container>
