<ng-container *ngIf="appComponent.contestQuery.valueChanges | async as contestResult">
  <ng-container *ngIf="contestResult.data as contest">
    <ng-container *ngFor="let problem of contest.problems">
      <form *ngIf="problem.name === problemName" class="submission_form" (submit)="$event.preventDefault(); 'TODO'">
        <div class="submission_form_body">
          <div *ngFor="let field of problem.material.submissionForm.fields" class="submission_file_field">
            <ng-container *ngIf="fieldState(field) as state">
              <label class="submission_file_label" [for]="field.id + '.file'">{{ field.title[0].value }}</label>
              <input class="submission_file_input" [id]="field.id + '.file'" [name]="field.id + '.file'" type="file"
                (change)="fieldState(field).file = $event.target.files[0]" />
              <label class="submission_file_choose_button" [for]="field.id + '.file'">Choose file</label>
              <dl *ngIf="state.file as file" class="submission_file_info">
                <dt>Name:</dt>
                <dd>{{ file.name }}</dd>
                <dt>Type:</dt>
                <dd [ngSwitch]="state.typeChoices.type">
                  <ng-container *ngSwitchCase="'oneRecommended'">
                    {{ state.typeChoices.recommendedType!.title[0].value }}
                    (<a href="#" class="submission_file_type_change" (click)="state.wantMoreTypes = true">change</a>)
                    <input type="hidden" [name]="field.id + '.type'" [value]="state.typeChoices.recommendedType!.id" />
                  </ng-container>
                  <ng-container *ngSwitchCase="'manyRecommended'">
                    <label *ngFor="let type of state.typeChoices.recommendedTypes!"
                      class="submission_file_type_suggested_option">
                      <input type="radio" [name]="field.id + '.type'" [value]="type.id" />
                      {{ type.title[0].value }}
                    </label>
                    (<a href="#" class="submission_file_type_more_options"
                      (click)="state.wantMoreTypes = true">more...</a>)
                  </ng-container>
                  <select *ngSwitchCase="'custom'" [name]="field.id + '.type'" class="submission_file_type_select">
                    <option *ngFor="let type of state.typeChoices.allTypes" [value]="type.id">
                      {{ type.title[0].value }}</option>
                  </select>
                </dd>
                <dt>Size:</dt>
                <dd>{{ file.size | filesize }}</dd>
              </dl>
            </ng-container>
          </div>
        </div>
        <div class="submission_form_footer">
          <button class="submission_form_submit" [disabled]="'TODO'" type="submit">Submit</button>
        </div>
      </form>
    </ng-container>
  </ng-container>
</ng-container>
